<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="full-screen" content="true" />
    <meta name="screen-orientation" content="landscape" />
    <meta name="x5-orientation" content="landscape">
    <meta name="x5-fullscreen" content="true" />
    <meta name="360-fullscreen" content="true" />
    <!-- uc应用模式 -->
    <meta name="browsermode" content="application">
    <!-- qq应用模式 -->
    <meta name="x5-page-mode" content="app">
    <style>
        body .mask-img {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            
        }
        body .mask-layer {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }
        html, body {
            -ms-touch-action: "none";
            background: #000000;
            padding: 0;
            border: 0;
            margin: 0;
            height: 100%
        }
         #loading{
            width: auto;  
        height: auto;  
        max-width: 70%;  
        max-height: 70%;   
        }
        #loading1{
            margin-bottom:auto;
                -webkit-animation:circle 1s infinite linear;/*匀速 循环*/
            }
            @-webkit-keyframes circle{
            0%{ transform:rotate(0deg); }
            100%{ transform:rotate(360deg); }
        }
    </style>
</head>

<body>
    <div id="bgDiv" class="mask-img" style="background: url('') no-repeat scroll center center/cover rgba(0, 0, 0, .1);">
<div class="mask-layer"></div>
</div>
<div id="gameDiv" style="margin:auto;width: 100%;height: 100%;" class="egret-player" data-entry-class="game.Main" data-orientation="landscape" data-scale-mode="fixedNarrow" data-resolution-mode="retina"
data-frame-rate="60" data-show-paint-rect="false" data-multi-fingered="2" data-show-fps="false" data-show-log="false" data-log-filter=""
data-show-fps-style="x:0,y:0,size:12,textColor:0xFFFFFF,bgAlpha:0.4" data-content-width="1280" data-content-height="720">
</div>
<div id="loadingDiv">
    <img id="loading" style="margin: auto; position: absolute;  top: 0; left: 0; bottom: 0; right: 0;"/>
<img id="loading2" style="margin: auto; position: absolute;  top: 0; left: 0; bottom: 0; right: 0;" src="resource/loading_first_black_bg.png" />
<img id="loading1" style="margin: auto; position: fixed;  top: 0; left: 0; bottom: 0; right: 0;z-index:1;" src="resource/loading_first_yellow_circle.png" />
</div>
<div id="no_canvasTip" style="margin: -150px 0 0 -475px;position:absolute;width: 1080px;height: 300px;top: 50%;left: 50%;display:none">
<p style="color: #ffffff;font-size: 26px;text-align: center;">您的当前浏览器无法打开该游戏！</p>
<p style="color: #ffffff;font-size: 26px;text-align: center;">如果您使用的是IE浏览器，请升级至<span style="color: red">IE10</span>及以上版本。</p>
<p style="color: #ffffff;font-size: 26px;text-align: center;">如果您使用的是QQ浏览器、360浏览器、猎豹浏览器等浏览器，请切换至<span style="color: red">极速模式</span>。</p>
<br>
<p style="color: #ffffff;font-size: 26px;text-align: center;">如果以上方法仍无法解决，请下载<span style="color: red">谷歌浏览器</span>，然后重试！</p>
</div>
<div id="no_egretTip" style="margin: -50px 0 0 -300px;position:absolute;width: 600px;height: 50px;top: 50%;left: 50%;display:none">
<p style="color: #ffffff;font-size: 40px;text-align: center;">资源下载失败，请刷新后重试 :（</p>
</div>
<script src="./../lib/TingCardTip.js" type="text/javascript"></script>
<script src="./../lib/screenfull.js" type="text/javascript"></script>
<script src="./../lib/userlib.js" type="text/javascript"></script>
<script src="./version.js" type="text/javascript"></script>
<script>
    function addIcon(iconName) {
        var link = document.createElement('link');
        link.type = 'image/x-icon';
        link.rel = 'shortcut icon';
        link.href = './../icon/' + iconName + '.ico';
        document.getElementsByTagName('head')[0].appendChild(link);
    }

    function IEVersion() {
        var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  
        var isIE = userAgent.indexOf("compatible") > -1 && userAgent.indexOf("MSIE") > -1; //判断是否IE<11浏览器  
        var isEdge = userAgent.indexOf("Edge") > -1 && !isIE; //判断是否IE的Edge浏览器  
        var isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf("rv:11.0") > -1;
        if (isIE) {
            var reIE = new RegExp("MSIE (\\d+\\.\\d+);");
            reIE.test(userAgent);
            var fIEVersion = parseFloat(RegExp["$1"]);
            if (fIEVersion == 7) {
                return 7;
            } else if (fIEVersion == 8) {
                return 8;
            } else if (fIEVersion == 9) {
                return 9;
            } else if (fIEVersion == 10) {
                return 10;
            } else {
                return 6;//IE版本<=7
            }
        } else if (isEdge) {
            return 'edge';//edge
        } else if (isIE11) {
            return 11; //IE11  
        } else {
            return -1;//不是ie浏览器
        }
    }

    var jsVersion = "1.5.24";
    var resVersion = "1.5.24";
    if (CONFIG) {
        resVersion = jsVersion = CONFIG.PUB_VERSION_NO;
    }
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
    let logoType = getQueryString("op_code");
    let lan = getQueryString("lan");
    if ((!lan || lan == "zh_CN") && IEVersion() != -1) {
        alert("当前游戏不支持ie浏览器，建议使用chorme,360,搜狗等其他浏览器进行游戏,有良好的游戏体验！")
    } else {
        if (!logoType) {
            logoType = "bole";
        }
        if (logoType == "bole") {
            if (lan == "ko_KR") {
                logoType = "bole_kr";
            } else if (lan == "vi_VN") {
                logoType = "bole_vn";
            }
        }
        if (!logoType || logoType == "inner") {
            document.getElementById("loading").style.display = "none";
            document.getElementById("loading1").style.display = "block";
            document.getElementById("loading2").style.display = "block";
        } else {
            document.getElementById("loading1").style.display = "none";
            document.getElementById("loading2").style.display = "none";
            document.getElementById("loading").style.display = "block"
            document.getElementById("loading").src = `./../logo/loading_${logoType}.png`;
        }
        switch (logoType) {
            case "bole_kr":
            case "bole_vn":
                document.title = "bolegaming";
                break;
            case "cfqp":
                document.title = "财富棋牌";
                break;
            case "bole":
                document.title = "博乐游戏";
                break;
            case "tlcbet":
                document.title = "同乐棋牌";
                break;
            case "dreamwork":
                document.title = "梦工厂棋牌";
                break;
            case "18luck":
                document.title = "新利棋牌";
                break;
            case "kingco":
                document.title = "kingco";
                break;
            case "ighot":
                document.title = "国际热女孩";
                break;
            case "633":
                document.title = "633棋牌";
                break;
            case "bsqp":
                document.title = "博胜棋牌";
                break;
            case "bfqp":
                document.title = "巴克斯棋牌";
                addIcon(logoType);
                break;
            default:
                document.title = "内网";
                break;
        }
        var loadScript = function (list, callback) {
            var loaded = 0;
            var loadNext = function () {
                loadSingleScript(list[loaded], function () {
                    loaded++;
                    if (loaded >= list.length) {
                        callback();
                    }
                    else {
                        loadNext();
                    }
                })
            };
            loadNext();
        };

        var loadSingleScript = function (src, callback) {
            var s = document.createElement("script");
            s.async = false;
            s.src = src + "?v=" + jsVersion;
            s.addEventListener("load", function () {
                s.parentNode.removeChild(s);
                s.removeEventListener("load", arguments.callee, false);
                callback();
            }, false);
            document.body.appendChild(s);
        };

        var xhr = new XMLHttpRequest();
        xhr.open("GET", "./manifest.json?v=" + Math.random(), true);
        xhr.addEventListener("load", function () {
            var manifest = JSON.parse(xhr.response);
            var list = manifest.initial.concat(manifest.game);
            loadScript(list, function () {
                /**判断浏览器是否支持canvas**/
                try {
                    document.createElement("canvas").getContext("2d");
                } catch (e) {
                    document.getElementById("loadingDiv").style.display = "none";
                    document.getElementById("no_canvasTip").style.display = "block";
                    return
                }
                try {
                    // if (!egret.Capabilities.isMobile) {
                    // requestAnimationFrame = function (callback) {
                    //     return window.setTimeout(callback, 1000 / 60);
                    // };
                    // }
                    /**
                 * {
                 * "renderMode":, //Engine rendering mode, "canvas" or "webgl"
                 * "audioType": 0 //Use the audio type, 0: default, 2: web audio, 3: audio
                 * "antialias": //Whether the anti-aliasing is enabled in WebGL mode, true: on, false: off, defaults to false
                 * "calculateCanvasScaleFactor": //a function return canvas scale factor
                 * }
                 **/
                    egret.runEgret({
                        renderMode: "webgl", audioType: 0, calculateCanvasScaleFactor: function (context) {
                            var backingStore = context.backingStorePixelRatio ||
                                context.webkitBackingStorePixelRatio ||
                                context.mozBackingStorePixelRatio ||
                                context.msBackingStorePixelRatio ||
                                context.oBackingStorePixelRatio ||
                                context.backingStorePixelRatio || 1;
                            return (window.devicePixelRatio || 1) / backingStore;
                        }
                    });
                } catch (e) {
                    document.getElementById("loadingDiv").style.display = "none";
                    document.getElementById("no_egretTip").style.display = "block";
                }
            });
        });
        xhr.send(null);
    }
</script>
</body>

</html>